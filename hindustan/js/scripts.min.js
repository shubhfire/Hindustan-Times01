function breakCalc(a){return a<=480?y="xs":y="md",y}function breakHeight(a){return"xs"==a?y=250:y=500,y}function logoSrc(){"xs"==breakpoint?img="img/ht-logo-sq.png":img="img/navlogo.png",$(".navbar-brand img").attr("src",img)}function isScrolledIntoView(a){var b=$(window).scrollTop(),c=b+$(window).height(),d=$(a).offset().top,e=d+$(a).height();return e<=c&&d>=b}function Utils(){}function awardPlural(a){return 1==a?y="award":y="awards",y}function century(a){return a<100?y="19"+a:y="20"+a.toString().substring(1),y}function tipX(a){var b=$(window).width(),c=$(".tip").width();return"xs"==breakpoint?a>b-c-20?y=a-c:y=a:a>b-c-30?y=a-45-c:y=a+10,y}function chart(a,b,c){function t(a){function d(a,b){return"gender"==b?"Gender":"place"==b?"india"==a?"State":"Country":"state"==b?"State / Country":"field"==b||"area"==b?"Discipline":void 0}$(".chart."+c+"."+b).prepend('<div class="legend"><div class="title">'+d(b,c)+"</div></div>"),$(".legend").hide();var f=[];a.forEach(function(a,b){var c={};b<7&&(c.key=a.key,c.color=e[b],f.push(c))}),a.length>7&&f.push({key:"Other",color:"#b3b3b3"}),f.forEach(function(a,d){$(".chart."+c+"."+b+" .legend").append('<div class="item"><div class="swatch" style="background: '+a.color+'"></div>'+a.key+"</div>")}),$(".legend").fadeIn()}function u(d){var e,f={};f[a]=b,e="none"==a?d:_.where(d,f);for(var g=_.chain(e).countBy(c).pairs().sortBy(1).reverse().pluck(0).value(),h=_.sortBy(e,g),i=_.groupByMulti(h,["year",c]),j=[],k=1954;k<2018;k++){var l=i[k];void 0==l&&(l={}),g.forEach(function(a){var b={};void 0==l[a]?(b.key=a,b.value=0,b.date=moment(k.toString())._d):(b.key=l[a][0][c],b.value=l[a].length,b.date=moment(l[a][0].year)._d),j.push(b)})}return d=j}var d="data/awards.csv",e=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3","#b3b3b3"],g={top:20,right:1,bottom:30,left:0},h=$(".chart-wrapper").width()-g.left-g.right,i=breakHeight(breakpoint)-g.top-g.bottom,j=$(".chart."+c+"."+b).offset().top,k=d3.select("body").append("div").attr("class","tip").style("position","absolute").style("z-index","20").style("visibility","hidden").style("top",40+j+"px"),l=d3.time.scale().range([0,h]),m=d3.scale.linear().range([i-10,0]),n=d3.scale.ordinal().range(e),o=d3.svg.axis().scale(l).orient("bottom").ticks(d3.time.years,5),p=d3.layout.stack().offset("silhouette").order("reverse").values(function(a){return a.values}).x(function(a){return a.date}).y(function(a){return a.value}),q=d3.nest().key(function(a){return a.key}),r=d3.svg.area().interpolate("basis").x(function(a){return l(a.date)}).y0(function(a){return m(a.y0)-.2}).y1(function(a){return m(a.y0+a.y)+.2}),s=d3.select(".chart."+c+"."+b).append("svg").attr("width",h+g.left+g.right).attr("height",i+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")");d3.csv(d,function(a){a=u(a);var d=p(q.entries(a));t(d),l.domain(d3.extent(a,function(a){return a.date})),m.domain([0,d3.max(a,function(a){return a.y0+a.y})]),s.selectAll(".layer").data(d).enter().append("path").attr("class","layer").attr("d",function(a){return r(a.values)}).style("fill",function(a,b){return n(b)}),s.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(o),"xs"==breakpoint&&$(".x.axis text").each(function(){var a=$(this).text(),b="'"+a.substr(2);$(this).text(b)}),s.selectAll(".layer").attr("opacity",1).on("mouseover",function(a,b){s.selectAll(".layer").transition().duration(100).attr("opacity",function(a,c){return c!=b?.6:1})}).on("mousemove",function(a,b){var c=d3.select(this).style("fill");mouse=d3.mouse(this),mousex=mouse[0];var d=l.invert(mousex),e=century(d.getYear());a.values.forEach(function(a){var b=a.date.toString().split(" ")[3];e==b&&k.style("left",tipX(mousex)+"px").html("<div class='year'>"+b+"</div><div class='key'><div style='background:"+c+"' class='swatch'>&nbsp;</div>"+a.key+"</div><div class='value'>"+a.value+" "+awardPlural(a.value)+"</div>").style("visibility","visible")})}).on("mouseout",function(a,b){s.selectAll(".layer").transition().duration(100).attr("opacity","1"),k.style("visibility","hidden")});var e=d3.select(".chart."+c+"."+b).append("div").attr("class","remove").style("position","absolute").style("z-index","19").style("width","2px").style("height","460px").style("top","10px").style("bottom","30px").style("left","0px").style("background","#fcfcfc");d3.select(".chart."+c+"."+b).on("mousemove",function(){mousex=d3.mouse(this),mousex=mousex[0]+5,e.style("left",mousex+"px")}).on("mouseover",function(){mousex=d3.mouse(this),mousex=mousex[0]+5,e.style("left",mousex+"px")});var g=(s.append("rect").attr("x",-1*h).attr("y",-1*i).attr("height",i).attr("width",h).attr("class","curtain").attr("transform","rotate(180)").style("fill","#fcfcfc"),s.transition().delay(100).duration(1500).ease("exp").each("end",function(){d3.select("line.guide").transition().style("opacity",0).remove()}));g.select("rect.curtain").attr("width",0),g.select("line.guide").attr("transform","translate("+h+", 0)")})}var breakpoint=breakCalc($(window).width());$(window).resize(function(){breakCalc($(window).width())}),logoSrc(),$(window).resize(function(){logoSrc()});var url=window.location.href,twitterShare="https://twitter.com/home?status=A visual history of India's top civilian awards "+url+" %23PadmaAwards @htTweets";$(".twitter-share").attr("href",twitterShare);var facebookShare="https://www.facebook.com/sharer/sharer.php?u="+url;$(".facebook-share").attr("href",facebookShare),Utils.prototype={constructor:Utils,isElementInView:function(a,b){var c=$(window).scrollTop(),d=c+$(window).height(),e=$(a).offset().top,f=e+$(a).height();return b===!0?c<e&&d>f:f<=d&&e>=c}};var Utils=new Utils;_.groupByMulti=function(a,b,c){if(!b.length)return a;var d=_.groupBy(a,b[0],c),e=b.slice(1);for(var f in d)d[f]=_.groupByMulti(d[f],e,c);return d};var colorrange=[];$(".chart").each(function(a){var b=$(this).attr("column"),c=$(this).attr("groupBy"),d=$(this).attr("filterBy");$(this).addClass(c).addClass(d),0==a&&chart(b,d,c)}),$(window).scroll(function(){$(".chart").each(function(a){var b=$(this).height();if(0==b){var c=$(this).attr("column"),d=$(this).attr("groupBy"),e=$(this).attr("filterBy"),f=Utils.isElementInView($(this),!1);f&&$(this)&&chart(c,e,d)}})});
